# ESP32-S3 Show 展示控制系统

## 📌 项目概述

这是一个基于ESP32-S3的展示控制系统，用于控制：
- **4个 360度连续旋转舵机** (小力舵机, PCA9685通道0-3)
- **4个 180度标准舵机** (大力舵机, PCA9685通道4-7)
- **5个步进电机+丝杆系统** (4个并联垂直控制 + 1个独立水平控制)

通过Web界面实时控制所有硬件，支持手机和电脑访问。

---

## 🎯 硬件配置总结

### 舵机分配
| 通道 | 类型 | 说明 |
|-----|------|------|
| 0-3 | 360度小力舵机 | 连续旋转，支持点动控制和中点校准 |
| 4-7 | 180度大力舵机 | 标准角度控制 (0-180度) |

### 步进电机引脚
| 功能 | STEP引脚 | DIR引脚 | ENABLE引脚 |
|------|---------|---------|-----------|
| 垂直丝杆 (4个并联) | GPIO 1 | GPIO 2 | GPIO 42 |
| 水平丝杆 (独立) | GPIO 41 | GPIO 40 | GPIO 39 |

---

## 🚀 快速开始

### 1. 上传代码
1. 安装Arduino IDE库:
   - `Adafruit PWM Servo Driver Library`
   - `WebSockets` (by Markus Sattler)
   - `AccelStepper`

2. 修改WiFi配置: 编辑 [config.h](config.h) 第6-7行
   ```cpp
   const char* WIFI_SSID = "你的WiFi名称";
   const char* WIFI_PASSWORD = "你的WiFi密码";
   ```

3. 选择开发板: **工具 → 开发板 → ESP32S3 Dev Module**

4. 上传代码到ESP32-S3

### 2. 连接硬件
详细接线说明请查看 **[WIRING.md](WIRING.md)**

### 3. 访问Web界面
1. 打开串口监视器 (波特率115200)，查看ESP32的IP地址
2. 在浏览器中输入 `http://[ESP32的IP地址]`
3. 开始控制！

---

## 🎨 Web界面功能

### 页面1: 360度小力舵机 (0-3)
- **中点设置**: 为每个舵机设置停止旋转的角度
- **点动控制**: 点击左/右箭头，舵机转一下后自动停止
- **调试模式**: 连续旋转测试，用于找到精确的中点角度

### 页面2: 180度大力舵机 (4-7)
- 标准角度控制 (0-180度)
- 5度步进增减
- 实时角度显示

### 页面3: 步进电机控制
- **垂直丝杆**: 上升/下降控制，4个电机同步运动
- **水平丝杆**: 左移/右移控制
- 支持自定义步数、归零、位置显示

---

## 📖 使用技巧

### 360度舵机调试流程
1. 在"调试模式"中，从90度开始测试
2. 如果舵机顺时针旋转，减小角度 (如85度)
3. 如果舵机逆时针旋转，增大角度 (如95度)
4. 找到完全停止的角度后，在"中点设置"中保存
5. 使用"点动控制"测试效果

### 步进电机方向调整
如果步进电机运动方向与预期相反:
1. 方法一: 交换驱动器的DIR+和DIR-接线
2. 方法二: 在代码中修改方向参数符号

---

## 📁 文件说明

| 文件 | 说明 |
|-----|------|
| [show.ino](show.ino) | 主程序入口 |
| [config.h](config.h) | 配置常量 (WiFi、引脚、参数) |
| [global.h](global.h) | 全局变量声明 |
| [servo_control.ino](servo_control.ino) | 舵机控制逻辑 |
| [stepper_control.ino](stepper_control.ino) | 步进电机控制逻辑 |
| [web_server.ino](web_server.ino) | Web服务器和API |
| [web_interface.h](web_interface.h) | Web界面HTML |
| [WIRING.md](WIRING.md) | 详细接线说明 |
| [README.md](README.md) | 本文件 |

---

## ⚙️ 配置说明

### 重要参数 (config.h)

```cpp
// 360度舵机中点 (可根据实际调整)
#define SERVO_360_CENTER_0 90  // 舵机0中点
#define SERVO_360_CENTER_1 90  // 舵机1中点
#define SERVO_360_CENTER_2 90  // 舵机2中点
#define SERVO_360_CENTER_3 90  // 舵机3中点
#define SERVO_360_MOVE_ANGLE 10  // 点动时旋转的角度

// 步进电机参数
#define DEFAULT_SPEED 1000     // 默认速度 (steps/s)
#define MAX_SPEED 2000         // 最大速度
#define ACCELERATION 500       // 加速度
```

---

## 🔧 故障排查

| 问题 | 解决方法 |
|-----|---------|
| 舵机抖动 | 检查舵机电源是否足够 (至少5A), 确认共地连接 |
| 步进电机不转 | 检查ENABLE引脚是否低电平，检查驱动器电源 |
| 360度舵机无法停止 | 使用"调试模式"重新校准中点角度 |
| WiFi连接失败 | 确认WiFi账号密码正确，ESP32仅支持2.4GHz |
| Web界面无响应 | 检查WebSocket连接状态，刷新页面 |

---

## 📝 版本信息

- **版本**: 1.0
- **基于**: ESP32-S3 Servo Link 项目
- **适配硬件**: 0-3小力360度舵机 + 4-7大力180度舵机

---

## 🎉 开始使用

一切准备就绪！查看 [WIRING.md](WIRING.md) 完成接线，上传代码，开始你的展示项目吧！
