# 动作脚本使用说明

## ✅ 已完成的修改

### 1️⃣ 开机初始角度修改

**旧配置**: 所有180度舵机默认90度（会碰到地面）

**新配置**:
```cpp
大力4: 60度
大力5: 145度
大力6: 125度
大力7: 90度
```

现在ESP32上电后，大力舵机会自动移动到安全位置，不会碰到地面。

---

## 🎬 动作脚本说明

### 动作1: 垂直丝杆上下运动
**动作序列**:
1. 垂直丝杆上升 10000步
2. 等待运动完成
3. 垂直丝杆下降 10000步
4. 等待运动完成

**用途**: 测试垂直丝杆的上下运动范围

---

### 动作2: 大力6摆动
**动作序列**:
1. 大力6: 125° → 170° (平滑过渡)
2. 延迟 300ms
3. 大力6: 170° → 80° (平滑过渡)
4. 延迟 300ms
5. 大力6: 80° → 125° (平滑过渡，回到初始位置)
6. 延迟 300ms

**用途**: 测试单个大力舵机的大幅度摆动

---

### 动作3: 大力4+5联动
**动作序列**:

**第一段**:
- 大力4: 60° → 75°
- 大力5: 145° → 120°
- (两个舵机同时平滑移动)
- 延迟 300ms

**第二段**:
- 大力4: 75° → 35°
- 大力5: 120° → 170°
- (两个舵机同时平滑移动)
- 延迟 300ms

**第三段**:
- 大力4: 35° → 60°
- 大力5: 170° → 145°
- (两个舵机同时平滑移动，回到初始位置)
- 延迟 300ms

**用途**: 测试两个舵机的协同运动，模拟机械臂抓取动作

---

### 动作4: 小力舵机左右摆动
**动作序列**:
1. 所有小力舵机设置到中点 (120°)
2. 延迟 500ms
3. **向左转动**: 所有小力舵机 → 110° (持续1秒)
4. **向右转动**: 所有小力舵机 → 130° (持续2秒)
5. **向左转动**: 所有小力舵机 → 110° (持续1秒)
6. **停止**: 所有小力舵机 → 120° (回到中点)

**注意**:
- 此动作使用的中点是 `120°`，可在 [config.h](config.h) 中修改 `SERVO_360_ACTION_CENTER`
- 如果你的360度舵机真实中点不是120度，请先修改配置

---

## 🖥️ Web界面使用

### 访问动作脚本页面
1. 打开Web界面: `http://[ESP32的IP地址]`
2. 点击侧边栏"动作脚本"
3. 看到4个动作按钮卡片

### 执行动作
1. 点击对应的"执行动作X"按钮
2. 观察右侧日志面板，会显示动作执行过程
3. 动作执行完成后，日志会显示"动作X完成"

### ⚠️ 注意事项
- **执行动作期间，请勿手动操作其他控制**
- 动作1（丝杆运动）需要较长时间完成（约10-20秒）
- 动作2、3、4执行时间约3-5秒
- 如需中途停止，刷新页面或使用紧急停止按钮

---

## 📁 文件说明

| 文件 | 修改内容 |
|-----|---------|
| [config.h](config.h) | 添加了初始角度配置和360度舵机动作参数 |
| [servo_control.ino](servo_control.ino) | 修改了初始化函数，使用自定义初始角度 |
| [action_scripts.ino](action_scripts.ino) | **新增**，包含4个动作函数的实现 |
| [web_server.ino](web_server.ino) | 添加了4个动作的API端点 |
| [web_interface.h](web_interface.h) | 添加了动作脚本页面和JavaScript函数 |

---

## 🔧 自定义动作参数

### 修改初始角度
编辑 [config.h](config.h):
```cpp
#define DEFAULT_ANGLE_SERVO_4 60    // 改为你想要的角度
#define DEFAULT_ANGLE_SERVO_5 145
#define DEFAULT_ANGLE_SERVO_6 125
#define DEFAULT_ANGLE_SERVO_7 90
```

### 修改360度舵机动作中点
编辑 [config.h](config.h):
```cpp
#define SERVO_360_ACTION_CENTER 120  // 改为你实际测试的中点
```

### 修改动作延迟和速度
编辑 [action_scripts.ino](action_scripts.ino):
- `smoothMoveServo(channel, targetAngle, 15)` ← 第三个参数是每步延迟(ms)，越小越快
- `delay(300)` ← 动作间延迟时间

---

## 🎯 测试流程

### 首次使用建议顺序：
1. ✅ 上传代码，观察大力舵机初始位置是否正确（不碰地）
2. ✅ 测试360度舵机中点（在"360度小力舵机"页面）
3. ✅ 确认360度舵机中点后，修改 `SERVO_360_ACTION_CENTER` 为实际中点
4. ✅ 重新上传代码
5. ✅ 按顺序测试动作1→2→3→4

---

## 🚀 代码已完成，可以直接上传使用！

所有功能已经实现：
- ✅ 开机安全初始位置
- ✅ 4个动作脚本
- ✅ Web界面动作按钮
- ✅ 平滑运动算法
- ✅ 实时日志反馈

现在可以上传代码到ESP32-S3，开始测试动作脚本了！🎉
